<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dynex &mdash; Dynex SDK 0.1.5 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Dynex SDK
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Dynex SDK Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">Dynex SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../welcome.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guides.html">Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../using.html">Using the Dynex SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sampler.html">Sampler Properties and Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../handbook.html">Problem-Solving Handbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="../machinelearning.html">Neuromorphic Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pytorch.html">Dynex PyTorch Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scikit.html">Dynex Scikit-Learn Plugin</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Dynex SDK</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Module code</a> &raquo;</li>
      <li>dynex</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for dynex</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Dynex SDK (beta) Neuromorphic Computing Library</span>
<span class="sd">Copyright (c) 2021-2023, Dynex Developers</span>

<span class="sd">All rights reserved.</span>

<span class="sd">1. Redistributions of source code must retain the above copyright notice, this list of</span>
<span class="sd">    conditions and the following disclaimer.</span>
<span class="sd"> </span>
<span class="sd">2. Redistributions in binary form must reproduce the above copyright notice, this list</span>
<span class="sd">   of conditions and the following disclaimer in the documentation and/or other</span>
<span class="sd">   materials provided with the distribution.</span>
<span class="sd"> </span>
<span class="sd">3. Neither the name of the copyright holder nor the names of its contributors may be</span>
<span class="sd">   used to endorse or promote products derived from this software without specific</span>
<span class="sd">   prior written permission.</span>

<span class="sd">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY</span>
<span class="sd">EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF</span>
<span class="sd">MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL</span>
<span class="sd">THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="sd">SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="sd">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="sd">INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT,</span>
<span class="sd">STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span>
<span class="sd">THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s2">&quot;0.1.5&quot;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Dynex Developers&#39;</span>
<span class="n">__credits__</span> <span class="o">=</span> <span class="s1">&#39;Dynex Developers, Contributors, Supporters and the Dynex Community&#39;</span>

<span class="c1">################################################################################################################################</span>
<span class="c1"># IMPORTS</span>
<span class="c1">################################################################################################################################</span>

<span class="c1"># Encryption:</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="kn">import</span> <span class="n">AES</span>
<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">secrets</span>

<span class="c1"># required libs:</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">ftplib</span> <span class="kn">import</span> <span class="n">FTP</span>
<span class="kn">import</span> <span class="nn">dimod</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># ini config reader:</span>
<span class="kn">import</span> <span class="nn">configparser</span>

<span class="c1"># progress information:</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">from</span> <span class="nn">tqdm.notebook</span> <span class="kn">import</span> <span class="n">tqdm</span>

<span class="c1"># test-net mode:</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># API functions:</span>
<span class="kn">import</span> <span class="nn">urllib.request</span><span class="o">,</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">base64</span>

<span class="c1">################################################################################################################################</span>
<span class="c1"># API FUNCTION CALLS</span>
<span class="c1">################################################################################################################################</span>

<span class="n">FILE_IV</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="n">FILE_KEY</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="n">MAX_CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">MAX_ANNEALING_TIME</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">MAX_DURATION</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">TOTAL_USAGE</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>

<span class="c1"># parse config file:</span>
<span class="k">try</span><span class="p">:</span>
	<span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">();</span>
	<span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;dynex.ini&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>
	<span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DYNEX&#39;</span><span class="p">][</span><span class="s1">&#39;API_ENDPOINT&#39;</span><span class="p">]</span>
	<span class="n">API_KEY</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DYNEX&#39;</span><span class="p">][</span><span class="s1">&#39;API_KEY&#39;</span><span class="p">];</span>
	<span class="n">API_SECRET</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;DYNEX&#39;</span><span class="p">][</span><span class="s1">&#39;API_SECRET&#39;</span><span class="p">];</span>
<span class="k">except</span><span class="p">:</span>
	<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] ERROR: missing configuration file dynex.ini&#39;</span><span class="p">);</span>

<div class="viewcode-block" id="account_status"><a class="viewcode-back" href="../dynex.html#dynex.account_status">[docs]</a><span class="k">def</span> <span class="nf">account_status</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the status of the Dynex SDK account:</span>

<span class="sd">    .. code-block:: </span>

<span class="sd">        ACCOUNT: &lt;YOUR ACCOUNT IDENTIFICATION&gt;</span>
<span class="sd">        API SUCCESSFULLY CONNECTED TO DYNEX</span>
<span class="sd">        -----------------------------------</span>
<span class="sd">        ACCOUNT LIMITS:</span>
<span class="sd">        MAXIMUM NUM_READS: 5,000,000</span>
<span class="sd">        MAXIMUM ANNEALING_TIME: 10,000</span>
<span class="sd">        MAXIMUM JOB DURATION: 60 MINUTES</span>
<span class="sd">        </span>
<span class="sd">        USAGE:</span>
<span class="sd">        TOTAL USAGE: 97,699,614,400 / 10,000,000,000,000 ( 0.976996144 %) NUM_READS x ANNEALING_TIME</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">check_api_status</span><span class="p">(</span><span class="n">logging</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span></div>

<div class="viewcode-block" id="check_api_status"><a class="viewcode-back" href="../dynex.html#dynex.check_api_status">[docs]</a><span class="k">def</span> <span class="nf">check_api_status</span><span class="p">(</span><span class="n">logging</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    </span>
<span class="sd">    Dynex API call to output the status of the Dynex SDK account</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - TRUE if the API call was successful, FALSE if the API call was not successful (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">global</span> <span class="n">FILE_IV</span>
    <span class="k">global</span> <span class="n">FILE_KEY</span>
    <span class="k">global</span> <span class="n">MAX_CHIPS</span><span class="p">,</span> <span class="n">MAX_ANNEALING_TIME</span><span class="p">,</span> <span class="n">MAX_DURATION</span><span class="p">,</span> <span class="n">TOTAL_USAGE</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">API_ENDPOINT</span><span class="o">+</span><span class="s1">&#39;?api_key=&#39;</span><span class="o">+</span><span class="n">API_KEY</span><span class="o">+</span><span class="s1">&#39;&amp;api_secret=&#39;</span><span class="o">+</span><span class="n">API_SECRET</span><span class="o">+</span><span class="s1">&#39;&amp;method=status&#39;</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ret</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">];</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">];</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;valid&#39;</span><span class="p">:</span>
        <span class="n">FILE_IV</span> <span class="o">=</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;i&#39;</span><span class="p">]);</span>
        <span class="n">FILE_KEY</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">];</span>
        <span class="n">MAX_CHIPS</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_chips&#39;</span><span class="p">];</span>
        <span class="n">MAX_ANNEALING_TIME</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_steps&#39;</span><span class="p">];</span>
        <span class="n">MAX_DURATION</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_duration&#39;</span><span class="p">];</span>
        <span class="n">MAX_USAGE</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;max_usage&#39;</span><span class="p">];</span>
        <span class="n">TOTAL_USAGE</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;total_usage&#39;</span><span class="p">];</span>
        <span class="n">ACCOUNT_NAME</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;account_name&#39;</span><span class="p">];</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ACCOUNT:&#39;</span><span class="p">,</span><span class="n">ACCOUNT_NAME</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;API SUCCESSFULLY CONNECTED TO DYNEX&#39;</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------------------------&#39;</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ACCOUNT LIMITS:&#39;</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAXIMUM NUM_READS:&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MAX_CHIPS</span><span class="p">));</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAXIMUM ANNEALING_TIME:&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MAX_ANNEALING_TIME</span><span class="p">));</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAXIMUM JOB DURATION:&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MAX_DURATION</span><span class="p">),</span><span class="s1">&#39;MINUTES&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;USAGE:&#39;</span><span class="p">);</span>
            <span class="n">usage_pct</span> <span class="o">=</span> <span class="n">TOTAL_USAGE</span> <span class="o">/</span> <span class="n">MAX_USAGE</span> <span class="o">*</span> <span class="mf">100.0</span><span class="p">;</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;TOTAL USAGE:&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">TOTAL_USAGE</span><span class="p">),</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">{:,}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">MAX_USAGE</span><span class="p">),</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">usage_pct</span><span class="p">,</span><span class="s1">&#39;%)&#39;</span><span class="p">,</span><span class="s1">&#39;NUM_READS x ANNEALING_TIME&#39;</span><span class="p">);</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;INVALID API CREDENTIALS&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span></div>

<div class="viewcode-block" id="update_job_api"><a class="viewcode-back" href="../dynex.html#dynex.update_job_api">[docs]</a><span class="k">def</span> <span class="nf">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">workers</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lowest_loc</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    </span>
<span class="sd">    Dynex API call to update the status of a job</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - TRUE if the job was successfully updated, FALSE if there was a problem with updating the job (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">url</span> <span class="o">=</span> <span class="n">API_ENDPOINT</span><span class="o">+</span><span class="s1">&#39;?api_key=&#39;</span><span class="o">+</span><span class="n">API_KEY</span><span class="o">+</span><span class="s1">&#39;&amp;api_secret=&#39;</span><span class="o">+</span><span class="n">API_SECRET</span><span class="o">+</span><span class="s1">&#39;&amp;method=update_job&amp;job_id=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;status=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;workers=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;lowest_loc=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lowest_loc</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;lowest_energy=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lowest_energy</span><span class="p">);</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ret</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">];</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] MALLOB: JOB UPDATED:&quot;</span><span class="p">,</span><span class="n">JOB_ID</span><span class="p">,</span><span class="s2">&quot;STATUS:&quot;</span><span class="p">,</span><span class="n">status</span><span class="p">);</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] ERROR DURING UPDATING JOB ON MALLOB&quot;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR DURING UPDATING JOB ON MALLOB&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span></div>

<div class="viewcode-block" id="generate_job_api"><a class="viewcode-back" href="../dynex.html#dynex.generate_job_api">[docs]</a><span class="k">def</span> <span class="nf">generate_job_api</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="n">annealing_time</span><span class="p">,</span> <span class="n">switchfraction</span><span class="p">,</span> <span class="n">num_reads</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum_stepsize</span><span class="o">=</span><span class="mf">0.00000006</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    </span>
<span class="sd">    Dynex API call to generate a new job</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - TRUE if the job was successfully created, FALSE if there was a problem with generating the job (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
	<span class="c1"># retrieve additional data from sampler class:</span>
    <span class="n">sampler_type</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">type</span><span class="p">;</span>
    <span class="n">sampler_num_clauses</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">;</span>
    <span class="n">filehash</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filehash</span><span class="p">;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">description</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">);</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">filename</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">);</span>
    <span class="n">downloadurl</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">downloadurl</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">);</span>
    <span class="n">solutionurl</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">solutionurl</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">);</span>
    <span class="n">solutionuser</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">);</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">API_ENDPOINT</span><span class="o">+</span><span class="s1">&#39;?api_key=&#39;</span><span class="o">+</span><span class="n">API_KEY</span><span class="o">+</span><span class="s1">&#39;&amp;api_secret=&#39;</span><span class="o">+</span><span class="n">API_SECRET</span><span class="o">+</span><span class="s1">&#39;&amp;method=generate_job&amp;annealing_time=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">annealing_time</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;switchfraction=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">switchfraction</span><span class="p">);</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;num_reads=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num_reads</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;alpha=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;beta=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;gamma=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;delta=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">delta</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;epsilon=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;zeta=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">zeta</span><span class="p">);</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;minimum_stepsize=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">minimum_stepsize</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&amp;sampler_type=&#39;</span><span class="o">+</span><span class="n">sampler_type</span><span class="o">+</span><span class="s1">&#39;&amp;num_clauses=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sampler_num_clauses</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">+=</span> <span class="s1">&#39;&amp;filehash=&#39;</span><span class="o">+</span><span class="n">filehash</span><span class="o">+</span><span class="s1">&#39;&amp;description=&#39;</span><span class="o">+</span><span class="n">description</span><span class="o">+</span><span class="s1">&#39;&amp;filename=&#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="s1">&#39;&amp;downloadurl=&#39;</span><span class="o">+</span><span class="n">downloadurl</span><span class="o">+</span><span class="s1">&#39;&amp;solutionurl=&#39;</span><span class="o">+</span><span class="n">solutionurl</span><span class="o">+</span><span class="s1">&#39;&amp;solutionuser=&#39;</span><span class="o">+</span><span class="n">solutionuser</span><span class="p">;</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ret</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">];</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] MALLOB: JOB CREATED: &quot;</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;job_id&#39;</span><span class="p">]);</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;job_id&#39;</span><span class="p">]);</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] ERROR CREATING JOB:&quot;</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]);</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span></div>

<div class="viewcode-block" id="get_status_details_api"><a class="viewcode-back" href="../dynex.html#dynex.get_status_details_api">[docs]</a><span class="k">def</span> <span class="nf">get_status_details_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="n">all_stopped</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    </span>
<span class="sd">    Dynex API call to retrieve status of the job</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - :LOC_MIN: Lowest value of global falsified soft clauses of the problem which is being sampled (`int`)</span>
<span class="sd">    </span>
<span class="sd">    - :ENERGY_MIN: Lowest QUBO energy of the problem which is being sampled (`double`)</span>
<span class="sd">    </span>
<span class="sd">    - :CHIPS: The number of chips which are currently sampling (`int`)</span>
<span class="sd">    </span>
<span class="sd">    - :retval: Tabulated overview of the job status, showing workers, found assignments, etc. (`string`)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">API_ENDPOINT</span><span class="o">+</span><span class="s1">&#39;?api_key=&#39;</span><span class="o">+</span><span class="n">API_KEY</span><span class="o">+</span><span class="s1">&#39;&amp;api_secret=&#39;</span><span class="o">+</span><span class="n">API_SECRET</span><span class="o">+</span><span class="s1">&#39;&amp;method=get_status&amp;job_id=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">ret</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
    <span class="n">table</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;WORKER&#39;</span><span class="p">,</span><span class="s1">&#39;VERSION&#39;</span><span class="p">,</span><span class="s1">&#39;CHIPS&#39;</span><span class="p">,</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">,</span><span class="s1">&#39;RUNTIME&#39;</span><span class="p">,</span><span class="s1">&#39;LAST UPDATE&#39;</span><span class="p">,</span> <span class="s1">&#39;STATUS&#39;</span><span class="p">]];</span>
    <span class="n">LOC_MIN</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>
    <span class="n">ENERGY_MIN</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>
    <span class="n">CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">worker</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;worker_id&#39;</span><span class="p">];</span>
        <span class="n">chips</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;chips&#39;</span><span class="p">];</span>
        <span class="n">started</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;created_at&#39;</span><span class="p">];</span>
        <span class="n">updated</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;updated_at&#39;</span><span class="p">];</span>
        <span class="n">loc</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">];</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]);</span>
        <span class="n">interval</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;lastupdate&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">60</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; min&#39;</span><span class="p">;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;version&#39;</span><span class="p">];</span>
        <span class="n">lastupdate</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">s ago&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">])</span>

        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;31m</span><span class="si">%s</span><span class="se">\033</span><span class="s2">[0m&quot;</span> <span class="o">%</span><span class="s1">&#39;STOPPED&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;runtime&#39;</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">60</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;32m</span><span class="si">%s</span><span class="se">\033</span><span class="s2">[0m&quot;</span> <span class="o">%</span><span class="s1">&#39;RUNNING&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="n">all_stopped</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\033</span><span class="s2">[1;31m</span><span class="si">%s</span><span class="se">\033</span><span class="s2">[0m&quot;</span> <span class="o">%</span><span class="s1">&#39;STOPPED&#39;</span><span class="p">;</span>

        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">worker</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">chips</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">interval</span><span class="p">,</span> <span class="n">lastupdate</span><span class="p">,</span> <span class="n">status</span><span class="p">]);</span>

        <span class="n">CHIPS</span> <span class="o">=</span> <span class="n">CHIPS</span> <span class="o">+</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;chips&#39;</span><span class="p">];</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">LOC_MIN</span><span class="p">:</span>
            <span class="n">LOC_MIN</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">];</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ENERGY_MIN</span><span class="p">:</span>
            <span class="n">ENERGY_MIN</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">];</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="c1"># not worked on:</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;*** WAITING FOR WORKERS ***&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
        <span class="n">LOC_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">ENERGY_MIN</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">retval</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;firstrow&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s2">&quot;rounded_grid&quot;</span><span class="p">,</span> <span class="n">stralign</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">CHIPS</span><span class="p">,</span> <span class="n">retval</span><span class="p">;</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># TEST FTP ACCESS</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="test_completed"><a class="viewcode-back" href="../dynex.html#dynex.test_completed">[docs]</a><span class="k">def</span> <span class="nf">test_completed</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - Returns TRUE if dynex.test() has been successfully completed, FALSE if dynex.test() was not successfully completed (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">local_path</span><span class="o">=</span><span class="s1">&#39;dynex.test&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">);</span></div>

<div class="viewcode-block" id="test"><a class="viewcode-back" href="../dynex.html#dynex.test">[docs]</a><span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs test of the dynex.ini settings. Successful completion is required to start using the sampler.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">allpassed</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: dimod BQM construction...&#39;</span><span class="p">)</span>
    <span class="n">bqm</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">BinaryQuadraticModel</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span> <span class="p">{(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">):</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s1">&#39;BINARY&#39;</span><span class="p">)</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">BQM</span><span class="p">(</span><span class="n">bqm</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: Dynex Sampler object...&#39;</span><span class="p">)</span>
    <span class="n">sampler</span> <span class="o">=</span> <span class="n">DynexSampler</span><span class="p">(</span><span class="n">model</span><span class="p">,</span>  <span class="n">mainnet</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: uploading computing file...&#39;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">upload_file_to_ftp</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">ftp_hostname</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">ftp_username</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">ftp_password</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="n">sampler</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">ftp_path</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">allpassed</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] FAILED&#39;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DYNEX TEST FAILED&quot;</span><span class="p">);</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: submitting sample file...&#39;</span><span class="p">)</span>
    <span class="n">worker_user</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">worker_pass</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">upload_file_to_ftp</span><span class="p">(</span><span class="n">sampler</span><span class="o">.</span><span class="n">solutionurl</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">worker_user</span><span class="p">,</span> <span class="n">worker_pass</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="n">sampler</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">sampler</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
    <span class="k">if</span> <span class="n">ret</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">allpassed</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] FAILED&#39;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DYNEX TEST FAILED&quot;</span><span class="p">);</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: retrieving samples...&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">files</span> <span class="o">=</span> <span class="n">list_files_with_text</span><span class="p">(</span><span class="n">sampler</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">allpassed</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] FAILED&#39;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DYNEX TEST FAILED&quot;</span><span class="p">);</span>

    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST: worker access to computing files&#39;</span><span class="p">)</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">downloadurl</span> <span class="o">+</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filename</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">html</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] PASSED&#39;</span><span class="p">);</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">allpassed</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] FAILED&#39;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;DYNEX TEST FAILED&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="n">allpassed</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST RESULT: ALL TESTS PASSED&#39;</span><span class="p">);</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;dynex.test&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST RESULT: ALL TESTS PASSED&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] TEST RESULT: ERRORS OCCURED&#39;</span><span class="p">);</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># conversation of k-sat to 3sat</span>
<span class="c1">################################################################################################################################</span>

<span class="k">def</span> <span class="nf">check_list_length</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    :Returns:</span>
<span class="sd">    - TRUE if the sat problem is k-Sat, FALSE if the problem is 3-sat or 2-sat (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sublist</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># find largest variable in clauses:</span>
<div class="viewcode-block" id="find_largest_value"><a class="viewcode-back" href="../dynex.html#dynex.find_largest_value">[docs]</a><span class="k">def</span> <span class="nf">find_largest_value</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - The largest variable in a list of clauses (`int`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">largest_value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">largest_value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">largest_value</span><span class="p">:</span>
                <span class="n">largest_value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">return</span> <span class="n">largest_value</span></div>

<span class="c1"># create a substitution clause:</span>
<div class="viewcode-block" id="sat_creator"><a class="viewcode-back" href="../dynex.html#dynex.sat_creator">[docs]</a><span class="k">def</span> <span class="nf">sat_creator</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">clause_type</span><span class="p">,</span> <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Converts a k-sat clause to a number of 3-sat clauses.</span>

<span class="sd">    :Parameters:</span>

<span class="sd">    - :variables:</span>
<span class="sd">    - :clause_type:</span>
<span class="sd">    - :dummy_number:</span>
<span class="sd">    - :results_clauses:</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - :dummy_number:</span>
<span class="sd">    - :results_clauses:</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">clause_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1">#Beginning clause</span>
        <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">variables</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">variables</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dummy_number</span><span class="p">])</span>
        <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">elif</span> <span class="n">clause_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="c1">#Middle clause</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">dummy_number</span>
            <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dummy_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">temp</span><span class="p">,</span> <span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dummy_number</span><span class="p">])</span>
            <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">elif</span> <span class="n">clause_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="c1">#Final clause</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">):</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">dummy_number</span>
            <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">dummy_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">temp</span><span class="p">,</span> <span class="n">variables</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dummy_number</span><span class="p">])</span>
            <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>   
        <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">dummy_number</span><span class="p">,</span> <span class="n">variables</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">variables</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">dummy_number</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">dummy_number</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="k">return</span> <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span></div>

<span class="c1"># convert from k-sat to 3sat:</span>
<div class="viewcode-block" id="ksat"><a class="viewcode-back" href="../dynex.html#dynex.ksat">[docs]</a><span class="k">def</span> <span class="nf">ksat</span><span class="p">(</span><span class="n">clauses</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Converts a k-sat formulation into 3-sat.</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - List of clauses of the converted 3-sat (`list`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">results_clauses</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="n">find_largest_value</span><span class="p">(</span><span class="n">clauses</span><span class="p">);</span>
    <span class="n">dummy_number</span> <span class="o">=</span> <span class="n">variables</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">:</span>
        <span class="n">total_variables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="c1">#Case 3 variables</span>
        <span class="k">if</span> <span class="n">total_variables</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#Case 1 variable</span>
            <span class="k">if</span> <span class="n">total_variables</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="c1">#Case 2 variables</span>
            <span class="k">elif</span> <span class="n">total_variables</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">results_clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">dummy_number</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c1">#Case more than 3 variable</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">first_clause</span> <span class="o">=</span> <span class="n">values</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span> <span class="o">=</span> <span class="n">sat_creator</span><span class="p">(</span><span class="n">first_clause</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span><span class="p">)</span>

                <span class="n">middle_clauses</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
                <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span> <span class="o">=</span> <span class="n">sat_creator</span><span class="p">(</span><span class="n">middle_clauses</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span><span class="p">)</span>

                <span class="n">last_clause</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span>
                <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span> <span class="o">=</span> <span class="n">sat_creator</span><span class="p">(</span><span class="n">last_clause</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dummy_number</span><span class="p">,</span> <span class="n">results_clauses</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">results_clauses</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># utility functions</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="calculate_sha3_256_hash"><a class="viewcode-back" href="../dynex.html#dynex.calculate_sha3_256_hash">[docs]</a><span class="k">def</span> <span class="nf">calculate_sha3_256_hash</span><span class="p">(</span><span class="n">string</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sha3_256_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha3_256</span><span class="p">()</span>
    <span class="n">sha3_256_hash</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">sha3_256_hash</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>

<div class="viewcode-block" id="Convert"><a class="viewcode-back" href="../dynex.html#dynex.Convert">[docs]</a><span class="k">def</span> <span class="nf">Convert</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">it</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">res_dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">it</span><span class="p">,</span> <span class="n">it</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">res_dct</span><span class="p">;</span></div>

<div class="viewcode-block" id="check_list_length"><a class="viewcode-back" href="../dynex.html#dynex.check_list_length">[docs]</a><span class="k">def</span> <span class="nf">check_list_length</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sublist</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sublist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="max_value"><a class="viewcode-back" href="../dynex.html#dynex.max_value">[docs]</a><span class="k">def</span> <span class="nf">max_value</span><span class="p">(</span><span class="n">inputlist</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">([</span><span class="n">sublist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">inputlist</span><span class="p">])</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># upload file to an FTP server</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="upload_file_to_ftp"><a class="viewcode-back" href="../dynex.html#dynex.upload_file_to_ftp">[docs]</a><span class="k">def</span> <span class="nf">upload_file_to_ftp</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">,</span> <span class="n">remote_directory</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Submits a computation file (xxx.bin) to the FTP server as defined in dynex.ini</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - Status if successul or failed (`bool`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="c1"># Change to the remote directory</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">remote_directory</span><span class="p">)</span>
    
        <span class="c1"># Open the local file in binary mode for reading</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">);</span> <span class="c1"># file size</span>
            <span class="c1"># sanity check:</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">104857600</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ERROR] PROBLEM FILE TOO LARGE (MAX 104,857,600 BYTES)&quot;</span><span class="p">);</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;PROBLEM FILE TOO LARGE (MAX 104,857,600 BYTES)&#39;</span><span class="p">);</span>
    
            <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
                <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">unit_scale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unit_divisor</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;file upload progress&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
                    
                    <span class="k">def</span> <span class="nf">cb</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                        <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
                    
                    <span class="c1"># Upload the file to the FTP server</span>
                    <span class="n">ftp</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;STOR </span><span class="si">{</span><span class="n">local_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">cb</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Upload the file to the FTP server</span>
                <span class="n">ftp</span><span class="o">.</span><span class="n">storbinary</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;STOR </span><span class="si">{</span><span class="n">local_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DYNEX] File &#39;</span><span class="si">{</span><span class="n">local_file_path</span><span class="si">}</span><span class="s2">&#39; sent successfully to &#39;</span><span class="si">{</span><span class="n">hostname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">remote_directory</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DYNEX] An error occurred while sending the file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">();</span>
    <span class="k">return</span> <span class="n">retval</span><span class="p">;</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># Cleanup FTP on sampler exit or clean()</span>
<span class="c1">################################################################################################################################</span>
<div class="viewcode-block" id="cleanup_ftp"><a class="viewcode-back" href="../dynex.html#dynex.cleanup_ftp">[docs]</a><span class="k">def</span> <span class="nf">cleanup_ftp</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="n">files</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    This function is called on __exit__ of the sampler class or by sampler.clear(). </span>
<span class="sd">    It ensures that submitted sample-files, which have not been parsed and used from the sampler, will be deleted on the FTP server. </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">host</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionurl</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span> 
            <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
            <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">directory</span><span class="p">);</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="n">ftp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
            <span class="k">if</span> <span class="n">sampler</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ÐYNEX] FTP DATA CLEANED&quot;</span><span class="p">);</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[DYNEX] An error occurred while deleting file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">();</span>
    <span class="k">return</span><span class="p">;</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># delete computing file on an FTP server</span>
<span class="c1">################################################################################################################################</span>
<div class="viewcode-block" id="delete_file_on_ftp"><a class="viewcode-back" href="../dynex.html#dynex.delete_file_on_ftp">[docs]</a><span class="k">def</span> <span class="nf">delete_file_on_ftp</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">local_file_path</span><span class="p">,</span> <span class="n">remote_directory</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Deletes a file on the FTP server as specified in dynex,ini</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">hostname</span><span class="p">)</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="c1"># Change to the remote directory</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">remote_directory</span><span class="p">)</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">local_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
    <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] COMPUTING FILE&quot;</span><span class="p">,</span> <span class="n">local_file_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;REMOVED&#39;</span><span class="p">);</span>
    <span class="k">return</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># retrieve all files starting with &quot;sampler.filename&quot; from an FTP server</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="list_files_with_text"><a class="viewcode-back" href="../dynex.html#dynex.list_files_with_text">[docs]</a><span class="k">def</span> <span class="nf">list_files_with_text</span><span class="p">(</span><span class="n">sampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Downloads assignment files from the FTP server specified in dynex.ini and stores them in /tmp as specified in dynex.ini</span>
<span class="sd">    Downloaded files are automatically deleted on the FTP server.</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - List of locally in /tmp saved assignment files for the current sampler model (`list`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">host</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionurl</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span> 
    <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filename</span><span class="p">;</span>
    <span class="c1"># Connect to the FTP server</span>
    <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    
    <span class="c1"># Change to the specified directory</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    
    <span class="c1"># List all (fully uploaded) files in the directory (minimum size)</span>
    <span class="n">target_size</span> <span class="o">=</span> <span class="mi">97</span> <span class="o">+</span> <span class="n">sampler</span><span class="o">.</span><span class="n">num_variables</span><span class="p">;</span>
    <span class="n">filtered_files</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">facts</span> <span class="ow">in</span> <span class="n">ftp</span><span class="o">.</span><span class="n">mlsd</span><span class="p">():</span> 
        <span class="k">if</span> <span class="s1">&#39;size&#39;</span> <span class="ow">in</span> <span class="n">facts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">facts</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">])</span><span class="o">&gt;=</span><span class="n">target_size</span> <span class="ow">and</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="n">filtered_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
                <span class="c1"># download file if not already local:</span>
                <span class="n">local_path</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="n">name</span><span class="p">;</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>	
                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
                        <span class="n">ftp</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s1">&#39;RETR &#39;</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">);</span> 
                        <span class="n">file</span><span class="o">.</span><span class="n">close</span><span class="p">();</span>
                        <span class="c1"># we delete downloaded files from FTP:</span>
                        <span class="n">ftp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">name</span><span class="p">);</span> 
    
    <span class="c1"># Close the FTP connection</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="c1"># In our status view, we show the local, downloaded and available files:</span>
    <span class="n">filtered_files</span> <span class="o">=</span> <span class="n">list_files_with_text_local</span><span class="p">(</span><span class="n">sampler</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="n">filtered_files</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># retrieve all files starting with &quot;sampler.filename&quot; from test-net</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="list_files_with_text_local"><a class="viewcode-back" href="../dynex.html#dynex.list_files_with_text_local">[docs]</a><span class="k">def</span> <span class="nf">list_files_with_text_local</span><span class="p">(</span><span class="n">sampler</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Scans the temporary directory for assignment files</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - Returns a list of all assignment files (filenames) which are locally available in /tmp as specified in dynex.ini for the current sampler model (`list`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">directory</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filepath_full</span><span class="p">;</span> 
    <span class="n">fn</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="p">;</span>
    <span class="c1"># list to store files</span>
    <span class="n">filtered_files</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
            <span class="n">filtered_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filtered_files</span><span class="p">;</span>    </div>
    
<span class="c1">################################################################################################################################</span>
<span class="c1"># Download file from FTP to sampler.filepath / filename</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="download_file"><a class="viewcode-back" href="../dynex.html#dynex.download_file">[docs]</a><span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">sampler</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Downloads a computed assigment file from the FTP server specified in dynex.ini </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">host</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionurl</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">solutionuser</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span> 
    <span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="n">local_path</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="n">filename</span><span class="p">;</span>
    <span class="c1"># Connect to the FTP server</span>
    <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    
    <span class="c1"># Change to the specified directory</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">cwd</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
    
    <span class="c1"># Download the file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">retrbinary</span><span class="p">(</span><span class="s1">&#39;RETR &#39;</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">);</span> <span class="c1"># download file locally</span>
        <span class="n">ftp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span> <span class="c1"># remove file from FTP</span>
    
    <span class="c1"># Close the FTP connection</span>
    <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># generate filehash for worker</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="generate_hash"><a class="viewcode-back" href="../dynex.html#dynex.generate_hash">[docs]</a><span class="k">def</span> <span class="nf">generate_hash</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - Returns the sha3-256 hash of a given file (`string`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">calculate_sha3_256_hash</span><span class="p">(</span><span class="n">data</span><span class="p">);</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># AES Encryption / Decryption class</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="aes_encrypt"><a class="viewcode-back" href="../dynex.html#dynex.aes_encrypt">[docs]</a><span class="k">def</span> <span class="nf">aes_encrypt</span><span class="p">(</span><span class="n">raw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>
<span class="sd">    </span>
<span class="sd">    :Returns:</span>

<span class="sd">    - Returns the encrypted string of &#39;raw&#39; with an AES Key privided by the Dynex platform (`string`)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">BLOCK_SIZE</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">pad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span> <span class="o">*</span> <span class="nb">chr</span><span class="p">(</span><span class="n">BLOCK_SIZE</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">%</span> <span class="n">BLOCK_SIZE</span><span class="p">)</span>
    <span class="n">unpad</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="nb">ord</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:])]</span>
    <span class="n">raw</span> <span class="o">=</span> <span class="n">pad</span><span class="p">(</span><span class="n">raw</span><span class="p">);</span>
    <span class="n">cipher</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">FILE_KEY</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">),</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">FILE_IV</span><span class="p">);</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">cipher</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">));</span>
    <span class="n">output_str</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">hexlify</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
    <span class="n">output_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">output_str</span><span class="p">)[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
    <span class="k">return</span> <span class="n">output_str</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># save clauses to SAT cnf file</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="save_cnf"><a class="viewcode-back" href="../dynex.html#dynex.save_cnf">[docs]</a><span class="k">def</span> <span class="nf">save_cnf</span><span class="p">(</span><span class="n">clauses</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">mainnet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Saves the model as an encrypted .bin file locally in /tmp as defined in dynex.ini </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">num_variables</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lit</span><span class="p">)</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">)</span> <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">);</span>
    <span class="n">num_clauses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clauses</span><span class="p">);</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;p cnf </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_variables</span><span class="p">,</span> <span class="n">num_clauses</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
            <span class="n">line_enc</span> <span class="o">=</span> <span class="n">aes_encrypt</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_enc</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
        
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_enc</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> 
        
        <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lit</span><span class="p">))</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; 0&#39;</span><span class="p">;</span>
        
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="n">line_enc</span> <span class="o">=</span> <span class="n">aes_encrypt</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_enc</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
        
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_enc</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># save wcnf file</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="save_wcnf"><a class="viewcode-back" href="../dynex.html#dynex.save_wcnf">[docs]</a><span class="k">def</span> <span class="nf">save_wcnf</span><span class="p">(</span><span class="n">clauses</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">num_variables</span><span class="p">,</span> <span class="n">num_clauses</span><span class="p">,</span> <span class="n">mainnet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Saves the model as an encrypted .bin file locally in /tmp as defined in dynex.ini </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s2">&quot;p wcnf </span><span class="si">%d</span><span class="s2"> </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">num_variables</span><span class="p">,</span> <span class="n">num_clauses</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
            <span class="n">line_enc</span> <span class="o">=</span> <span class="n">aes_encrypt</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_enc</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_enc</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> 

        <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lit</span><span class="p">))</span> <span class="k">for</span> <span class="n">lit</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; 0&#39;</span><span class="p">;</span>
        
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="n">line_enc</span> <span class="o">=</span> <span class="n">aes_encrypt</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_enc</span> <span class="o">=</span> <span class="n">line</span><span class="p">;</span>
        
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line_enc</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span> </div>

        
<span class="c1">################################################################################################################################</span>
<span class="c1"># functions to convert BQM to wcnf</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="convert_bqm_to_wcnf"><a class="viewcode-back" href="../dynex.html#dynex.convert_bqm_to_wcnf">[docs]</a><span class="k">def</span> <span class="nf">convert_bqm_to_wcnf</span><span class="p">(</span><span class="n">bqm</span><span class="p">,</span> <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `Internal Function`</span>

<span class="sd">    Converts a given Binary Quadratic Model (BQM) problem into a wncf file which is being used by the Dynex platform workers for the sampling process. Every BQM can be converted to a QUBO formulation in polynomial time (and vice-versa) without loss of functionality. During the process, variables are re-labeld and mapped to integer values in the range of [0, NUM_VARIABLES}. The mapping is being made available in sampler.variable_mappings and is used for constructing the returned sampleset object.</span>

<span class="sd">    :Notes: </span>

<span class="sd">    - The BQM needs to have at least one defined weight, otherwise an exception is thrown</span>
<span class="sd">    - Double values of weights are being converted to integer values with the factor &#39;PRECISION&#39; </span>
<span class="sd">    - The value for PRECISION is determined automatically with function 10 ** (np.floor(np.log10(max_abs_coeff)) - 4)</span>

<span class="sd">    :Parameters:</span>

<span class="sd">    - :bqm: the Binary Quadratic Model to be converted (class:`dimod.BinaryQuadraticModel`)</span>

<span class="sd">    :Returns:</span>

<span class="sd">    - :clauses: A list of all clauses (`list`)</span>
<span class="sd">    - :num_variables: number of variables (`int`)</span>
<span class="sd">    - :num_clauses: number of clauses (`int`)</span>
<span class="sd">    - :mappings: variable mappings original -&gt; integer value (`dict`)</span>
<span class="sd">    - :precision: precision of conversion (`double`)</span>
<span class="sd">    - :bqm: class:`dimod.BinaryQuadraticModel`</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># relabel variables to integers:</span>
    <span class="n">mappings</span> <span class="o">=</span> <span class="n">bqm</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">_relabel_as_integers</span><span class="p">();</span>
    
    <span class="c1"># convert bqm to_qubo model:</span>
    <span class="n">clauses</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">bqm</span><span class="o">.</span><span class="n">to_qubo</span><span class="p">();</span>
    <span class="n">Q_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] MODEL CONVERTED TO QUBO&quot;</span><span class="p">)</span>
    
    <span class="c1"># precision:</span>
    <span class="n">newQ</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q_list</span><span class="p">)):</span>
        <span class="n">touple</span> <span class="o">=</span> <span class="n">Q_list</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">touple</span><span class="p">];</span>
        <span class="n">newQ</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">);</span>
    <span class="n">max_abs_coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">newQ</span><span class="p">));</span>
    <span class="k">if</span> <span class="n">max_abs_coeff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] ERROR: AT LEAST ONE WEIGHT MUST BE &gt; 0.0&#39;</span><span class="p">);</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;ERROR: AT LEAST ONE WEIGHT MUST BE &gt; 0.0&quot;</span><span class="p">);</span>

    <span class="n">precision</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_abs_coeff</span><span class="p">))</span> <span class="o">-</span> <span class="mi">4</span><span class="p">);</span>

    <span class="c1"># max precision is 1:</span>
    <span class="k">if</span> <span class="n">precision</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ÐYNEX] PRECISION CUT FROM&quot;</span><span class="p">,</span><span class="n">precision</span><span class="p">,</span><span class="s2">&quot;TO 1&quot;</span><span class="p">);</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] PRECISION SET TO&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">);</span>

    <span class="c1"># constant offset:</span>
    <span class="n">W_add</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> 
    <span class="k">if</span> <span class="n">logging</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] QUBO: Constant offset of the binary quadratic model:&quot;</span><span class="p">,</span> <span class="n">W_add</span><span class="p">);</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Q_list</span><span class="p">)):</span>
        <span class="n">touple</span> <span class="o">=</span> <span class="n">Q_list</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">touple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="c1"># +1 because vars need to start with 1</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">touple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span> <span class="c1"># +1 because vars need to start with 1</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Q</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">touple</span><span class="p">];</span>
        <span class="n">w_int</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">w</span><span class="o">/</span><span class="n">precision</span><span class="p">));</span>
        
        <span class="c1"># linear term:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">j</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w_int</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">w_int</span><span class="p">,</span><span class="o">-</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">if</span> <span class="n">w_int</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">w_int</span><span class="p">,</span> <span class="n">i</span><span class="p">]);</span>
        
        <span class="c1"># quadratic term:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">!=</span><span class="n">j</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w_int</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">w_int</span><span class="p">,</span> <span class="o">-</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">]);</span>
            <span class="k">if</span> <span class="n">w_int</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">w_int</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">j</span><span class="p">]);</span>
                <span class="n">clauses</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="o">-</span><span class="n">w_int</span><span class="p">,</span> <span class="n">j</span><span class="p">]);</span>
        
    <span class="n">num_variables</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bqm</span><span class="o">.</span><span class="n">variables</span><span class="p">);</span>
    <span class="n">num_clauses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clauses</span><span class="p">);</span>

    <span class="c1"># re-map variables from integer to original using self.var_mapping:</span>
    <span class="n">bqm</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">_relabel</span><span class="p">(</span><span class="n">mappings</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">clauses</span><span class="p">,</span> <span class="n">num_variables</span><span class="p">,</span> <span class="n">num_clauses</span><span class="p">,</span> <span class="n">mappings</span><span class="p">,</span> <span class="n">precision</span><span class="p">,</span> <span class="n">bqm</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># Supported Model Classes</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="SAT"><a class="viewcode-back" href="../dynex.html#dynex.SAT">[docs]</a><span class="k">class</span> <span class="nc">SAT</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a model, which can be used by the sampler based on a SAT problem. The Dynex sampler needs a &quot;model&quot; object for sampling. Based on the problem formulation, multiple model classes are supported.</span>

<span class="sd">        :Parameters:</span>

<span class="sd">        - :clauses: List of sat caluses for this model (`list`)</span>
<span class="sd">        - :logging: True to show model creation information, False to silence outputs (`bool`)</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        - class:`dynex.model`</span>

<span class="sd">    :Example:</span>

<span class="sd">    Dimod&#39;s dimod.binary.BinaryQuadraticModel (BQM) contains linear and quadratic biases for problems formulated as binary quadratic models as well as additional information such as variable labels and offset.</span>

<span class="sd">    .. code-block:: Python</span>

<span class="sd">        clauses = [[1, -2, 3], [-1, 4, 5], [6, 7, -8], [-9, -10, 11], [12, 13, -14],</span>
<span class="sd">           [-1, 15, -16], [17, -18, 19], [-20, 2, 3], [4, -5, 6], [-7, 8, 9],</span>
<span class="sd">           [10, 11, -12], [-13, -14, 15], [16, 17, -18], [-19, 20, 1], [2, -3, 4],</span>
<span class="sd">           [-5, 6, 7], [8, 9, -10], [-11, -12, 13], [14, 15, -16], [-17, 18, 19]]</span>
<span class="sd">        model =  dynex.SAT(clauses)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">clauses</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">clauses</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;cnf&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="s1">&#39;SAT&#39;</span><span class="p">;</span></div>

<div class="viewcode-block" id="BQM"><a class="viewcode-back" href="../dynex.html#dynex.BQM">[docs]</a><span class="k">class</span> <span class="nc">BQM</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a model, which can be used by the sampler based on a Binary Quadratic Model (BQM) problem. The Dynex sampler needs a &quot;model&quot; object for sampling. Based on the problem formulation, multiple model classes are supported.</span>
<span class="sd">    </span>
<span class="sd">        :Parameters:</span>

<span class="sd">        - :bqm: The BQM to be used for this model (class:`dimod.BinaryQuadraticModel`)</span>
<span class="sd">        - :relabel: Defines if the BQM&#39;s variable names should be relabeled (`bool`)</span>
<span class="sd">        - :logging: True to show model creation information, False to silence outputs (`bool`)</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        - class:`dynex.model`</span>

<span class="sd">    :Example:</span>

<span class="sd">    Dimod&#39;s `dimod.binary.BinaryQuadraticModel` (BQM) contains linear and quadratic biases for problems formulated as binary quadratic models as well as additional information such as variable labels and offset.</span>

<span class="sd">    .. code-block:: Python</span>

<span class="sd">        bqm = dimod.BinaryQuadraticModel({&#39;x1&#39;: 1.0, &#39;x2&#39;: -1.5, &#39;x3&#39;: 2.0}, </span>
<span class="sd">                                 {(&#39;x1&#39;, &#39;x2&#39;): 1.0, (&#39;x2&#39;, &#39;x3&#39;): -2.0}, </span>
<span class="sd">                                 0.0, dimod.BINARY)</span>
<span class="sd">        model = dynex.BQM(bqm)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bqm</span><span class="p">,</span> <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span> <span class="o">=</span> <span class="n">convert_bqm_to_wcnf</span><span class="p">(</span><span class="n">bqm</span><span class="p">,</span> <span class="n">relabel</span><span class="p">,</span> <span class="n">logging</span><span class="p">);</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;wcnf&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="s1">&#39;BQM&#39;</span><span class="p">;</span></div>

<div class="viewcode-block" id="CQM"><a class="viewcode-back" href="../dynex.html#dynex.CQM">[docs]</a><span class="k">class</span> <span class="nc">CQM</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a model, which can be used by the sampler based on a Constraint Quadratic Model (CQM) problem. The Dynex sampler needs a &quot;model&quot; object for sampling. Based on the problem formulation, multiple model classes are supported.</span>

<span class="sd">        :Parameters:</span>

<span class="sd">        - :cqm: The BQM to be used for this model (class:`dimod.ConstraintQuadraticModel`)</span>
<span class="sd">        - :relabel: Defines if the BQM&#39;s variable names should be relabeled (`bool`)</span>
<span class="sd">        - :logging: True to show model creation information, False to silence outputs (`bool`)</span>
<span class="sd">        </span>
<span class="sd">        :Returns:</span>
<span class="sd">        </span>
<span class="sd">        - class:`dynex.model`</span>

<span class="sd">    :Example:</span>

<span class="sd">    Dimod&#39;s `dimod.ConstrainedQuadraticModel` (CQM) contains linear and quadratic biases for problems formulated as constrained quadratic models as well as additional information such as variable labels, offsets, and equality and inequality constraints.</span>

<span class="sd">    .. code-block:: Python</span>

<span class="sd">        num_widget_a = dimod.Integer(&#39;num_widget_a&#39;, upper_bound=7)</span>
<span class="sd">        num_widget_b = dimod.Integer(&#39;num_widget_b&#39;, upper_bound=3)</span>
<span class="sd">        cqm = dimod.ConstrainedQuadraticModel()</span>
<span class="sd">        cqm.set_objective(-3 * num_widget_a - 4 * num_widget_b)</span>
<span class="sd">        cqm.add_constraint(num_widget_a + num_widget_b &lt;= 5, label=&#39;total widgets&#39;)</span>
<span class="sd">        model = dynex.CQM(cqm)</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cqm</span><span class="p">,</span> <span class="n">relabel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">bqm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">invert</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">cqm_to_bqm</span><span class="p">(</span><span class="n">cqm</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span> <span class="o">=</span> <span class="n">convert_bqm_to_wcnf</span><span class="p">(</span><span class="n">bqm</span><span class="p">,</span> <span class="n">relabel</span><span class="p">,</span> <span class="n">logging</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;wcnf&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="s1">&#39;CQM&#39;</span><span class="p">;</span></div>

<span class="c1">################################################################################################################################</span>
<span class="c1"># Dynex Sampler class</span>
<span class="c1">################################################################################################################################</span>

<div class="viewcode-block" id="DynexSampler"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler">[docs]</a><span class="k">class</span> <span class="nc">DynexSampler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialises the sampler object given a model.</span>

<span class="sd">        :Parameters:</span>

<span class="sd">        - :logging: Defines if the sampling process should be quiet with no terminal output (FALSE) or if process updates are to be shown (`bool`)</span>
<span class="sd">        - :mainnet: Defines if the mainnet (Dynex platform sampling) or the testnet (local sampling) is being used for sampling (`bool`)</span>
<span class="sd">        - :description: Defines the description for the sampling, which is shown in Dynex job dashboards as well as in the market place  (`string`)</span>

<span class="sd">        :Returns:</span>

<span class="sd">        - class:`dynex.samper`</span>

<span class="sd">        :Example:</span>

<span class="sd">        .. code-block:: Python</span>

<span class="sd">            sampler = dynex.DynexSampler(model)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mainnet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Dynex SDK Job&#39;</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">test_completed</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;CONFIGURATION TEST NOT COMPLETED. PLEASE RUN &#39;dynex.test()&#39;&quot;</span><span class="p">);</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span><span class="p">;</span>

        <span class="c1"># parse config file:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">();</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;dynex.ini&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;UTF-8&#39;</span><span class="p">);</span>
        
        <span class="c1"># SDK Authenticaton:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_api_status</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;API credentials invalid&quot;</span><span class="p">);</span>

        <span class="c1"># FTP &amp; HTTP GET data where miners are accessing problem files:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_hostname</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_COMPUTING_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_hostname&#39;</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_username</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_COMPUTING_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_username&#39;</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_password</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_COMPUTING_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_password&#39;</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftp_path</span>     <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_COMPUTING_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_path&#39;</span><span class="p">];</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">downloadurl</span>  <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_COMPUTING_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;downloadurl&#39;</span><span class="p">];</span>
        
        <span class="c1"># FTP data where miners submit results:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solutionurl</span>  <span class="o">=</span> <span class="s1">&#39;ftp://&#39;</span><span class="o">+</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_SOLUTION_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_hostname&#39;</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solutionuser</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_SOLUTION_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_username&#39;</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;:&quot;</span><span class="o">+</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;FTP_SOLUTION_FILES&#39;</span><span class="p">][</span><span class="s1">&#39;ftp_password&#39;</span><span class="p">];</span>
        
        <span class="c1"># local path where tmp files are stored</span>
        <span class="n">tmppath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;tmp/test.bin&quot;</span><span class="p">);</span>
        <span class="n">tmppath</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tmppath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;0123456789ABCDEF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span> <span class="o">=</span> <span class="s1">&#39;tmp/&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filepath_full</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/tmp&#39;</span>

        <span class="c1"># path to testnet</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solverpath</span> <span class="o">=</span> <span class="s1">&#39;testnet/&#39;</span><span class="p">;</span>

        <span class="c1"># auto generated temp filename:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.bin&quot;</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainnet</span> <span class="o">=</span> <span class="n">mainnet</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">typestr</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;cnf&#39;</span><span class="p">:</span>
            <span class="c1"># convert to 3sat?</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">check_list_length</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">)):</span>
                <span class="c1"># we need to convert to 3sat:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">ksat</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">;</span>
            <span class="n">save_cnf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">mainnet</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">);</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">=</span> <span class="n">max_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;wcnf&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">num_variables</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">precision</span><span class="p">;</span>
            <span class="n">save_wcnf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">,</span> <span class="n">mainnet</span><span class="p">);</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">filehash</span>     <span class="o">=</span> <span class="n">generate_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimod_assignments</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bqm</span><span class="p">;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] SAMPLER INITIALISED&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="DynexSampler.clean"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler.clean">[docs]</a>    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function should be called after finishing a sampling process on the Mainnet. It ensures that submitted sample-files,</span>
<span class="sd">        which have not been parsed and used from the sampler, will be deleted on the FTP server. It is also called automatically </span>
<span class="sd">        during __exit___ event of the sampler class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainnet</span><span class="p">:</span>
            <span class="n">files</span> <span class="o">=</span> <span class="n">list_files_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> 
            <span class="n">cleanup_ftp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">);</span></div>

    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Upon __exit__, the function clean() is being called.</span>
<span class="sd">        &quot;&quot;&quot;</span>
    	<span class="c1"># delete remaining, not parsed files on FTP server:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clean</span><span class="p">();</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] SAMPLER EXIT&#39;</span><span class="p">);</span>
        
<div class="viewcode-block" id="DynexSampler.update"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Typically, the sampler object is being initialised with a defined model class. This model can also be updated without</span>
<span class="sd">        regenerating a new sampler object by calling the function update(model).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logging</span> <span class="o">=</span> <span class="n">logging</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>     <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.bin&quot;</span><span class="p">;</span> 
        
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;cnf&#39;</span><span class="p">:</span>
            <span class="c1"># convert to 3sat?</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">check_list_length</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">ksat</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">;</span>
            <span class="n">save_cnf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;wcnf&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">clauses</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">num_variables</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">precision</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">precision</span><span class="p">;</span>
            <span class="n">save_wcnf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainnet</span><span class="p">);</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">filehash</span>     <span class="o">=</span> <span class="n">generate_hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">);</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">type</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimod_assignments</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">bqm</span><span class="p">;</span></div>

    <span class="c1"># print summary of sampler:</span>
<div class="viewcode-block" id="DynexSampler.print"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler.print">[docs]</a>    <span class="k">def</span> <span class="nf">print</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints summary information about the sampler object:</span>

<span class="sd">        - :Mainnet: If the mainnet (Dynex platform sampling) or the testnet (local sampling) is being used for sampling (`bool`)</span>
<span class="sd">        - :logging: Show progress and status information or be quiet and omit terminal output (`bool`)</span>
<span class="sd">        - :tmp filename: The filename of the computation file (`string`)</span>
<span class="sd">        - :tmp_filehash: The checksum hash of the computation file (`string`)</span>
<span class="sd">        - :model type: [cnf, wcnf]: The type of the model: Sat problems (cnf) or QUBU/Ising type problems (wcnf) (`string`)</span>
<span class="sd">        - :num_variables: The number of variables of the model (`int`)</span>
<span class="sd">        - :num_clauses: The number of clauses of the model (`int`)</span>

<span class="sd">        :Example:</span>

<span class="sd">        .. code-block:: </span>

<span class="sd">            DynexSampler object</span>
<span class="sd">            mainnet? True</span>
<span class="sd">            logging? True</span>
<span class="sd">            tmp filename: tmp/b8fa34a815f96098438d68142dfb68b6.bin</span>
<span class="sd">            tmp filehash: 0ee4a280b9ae5a91f48e8b3c760192dfba5397ae4ff1bd68879914efe829af9a</span>
<span class="sd">            model type: BQM</span>
<span class="sd">            num variables: 15</span>
<span class="sd">            num clauses: 120</span>
<span class="sd">            configuration: dynex.ini</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;{DynexSampler object}&#39;</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mainnet?&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainnet</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;logging?&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tmp filename:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tmp filehash:&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">filehash</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;model type:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">typestr</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num variables:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;num clauses:&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_clauses</span><span class="p">);</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;configuration: dynex.ini&#39;</span><span class="p">);</span></div>

    <span class="c1"># convert a sampler.sampleset[x][&#39;sample&#39;] into an assignment:</span>
<div class="viewcode-block" id="DynexSampler.sample_to_assignments"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler.sample_to_assignments">[docs]</a>    <span class="k">def</span> <span class="nf">sample_to_assignments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lowest_set</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The voltates of a sampling can be retrieved from the sampler with sampler.sampleset</span>

<span class="sd">        The sampler.sampleset returns a list of voltages for each variable, ranging from -1.0 to +1.0 and is a double precision value. Sometimes it is required to transform these voltages to binary values 0 (for negative voltages) or 1 (for positive voltages). This function converts a given sampler.sampleset[x] from voltages to binary values.</span>

<span class="sd">        :Parameters:</span>

<span class="sd">        - :lowest_set: The class:`dynex.sampler.assignment&#39; which has to be converted (`list`)</span>

<span class="sd">        :Returns:</span>

<span class="sd">        - Returns the converted sample as `list`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="p">{};</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">:</span>
            <span class="n">sample</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lowest_set</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">sample</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">sample</span><span class="p">;</span></div>
        
    <span class="c1"># sampling process:</span>
<div class="viewcode-block" id="DynexSampler.sample"><a class="viewcode-back" href="../dynex.html#dynex.DynexSampler.sample">[docs]</a>    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_reads</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span> <span class="n">annealing_time</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">switchfraction</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zeta</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">minimum_stepsize</span> <span class="o">=</span> <span class="mf">0.00000006</span><span class="p">,</span> <span class="n">debugging</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The main sampling function:</span>

<span class="sd">        :Parameters:</span>

<span class="sd">        - :num_reads: Defines the number of parallel samples to be performed (`int` value in the range of [32, MAX_NUM_READS] as defined in your license)</span>

<span class="sd">        - :annealing_time: Defines the number of integration steps for the sampling. Models are being converted into neuromorphic circuits, which are then simulated with ODE integration by the participating workers (`int` value in the range of [1, MAX_ANNEALING_TIME] as defined in your license)</span>

<span class="sd">        - :switchfraction: Defines the percentage of variables which are replaced by random values during warm start samplings (`double` in the range of [0.0, 1.0])</span>

<span class="sd">        - :alpha: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :beta: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :gamma: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :delta: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :epsilon: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :zeta: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is using automatic tuning of these parameters for the ODE integration. Setting values defines the upper bound for the automated parameter tuning (`double` value in the range of of [0.00000001, 100.0] for alpha and beta, and [0.0 and 1.0] for gamma, delta and epsilon)</span>

<span class="sd">        - :minimum_stepsize: The ODE integration of the QUBU/Ising or SAT model based neuromorphic circuits is performig adaptive stepsizes for each ODE integration forward Euler step. This value defines the smallest step size for a single adaptive integration step (`double` value in the range of [0.0000000000000001, 1.0])</span>

<span class="sd">        - :debugging: Only applicable for test-net sampling. Defines if the sampling process should be quiet with no terminal output (FALSE) or if process updates are to be shown (TRUE) (`bool`)</span>

<span class="sd">        :Returns:</span>

<span class="sd">        - Returns a dimod sampleset object class:`dimod.sampleset`</span>

<span class="sd">        :Example:</span>

<span class="sd">        .. code-block:: </span>

<span class="sd">            import dynex</span>
<span class="sd">            import dimod</span>

<span class="sd">            # Define the QUBU problem:</span>
<span class="sd">            bqmodel = dimod.BinaryQuadraticModel({0: -1, 1: -1}, {(0, 1): 2}, 0.0, dimod.BINARY)  </span>

<span class="sd">            # Sample the problem:</span>
<span class="sd">            model = dynex.BQM(bqmodel)</span>
<span class="sd">            sampler = dynex.DynexSampler(model)</span>
<span class="sd">            sampleset = sampler.sample(num_reads=32, annealing_time = 100)</span>

<span class="sd">            # Output the result:</span>
<span class="sd">            print(sampleset)</span>

<span class="sd">        .. code-block:: </span>

<span class="sd">            ╭────────────┬───────────┬───────────┬─────────┬─────┬─────────┬───────┬─────┬──────────┬──────────╮</span>
<span class="sd">            │   DYNEXJOB │   ELAPSED │   WORKERS │   CHIPS │   ✔ │   STEPS │   LOC │   ✔ │   ENERGY │        ✔ │</span>
<span class="sd">            ├────────────┼───────────┼───────────┼─────────┼─────┼─────────┼───────┼─────┼──────────┼──────────┤</span>
<span class="sd">            │       3617 │      0.07 │         1 │       0 │  32 │     100 │     0 │   1 │        0 │ 10000.00 │</span>
<span class="sd">            ╰────────────┴───────────┴───────────┴─────────┴─────┴─────────┴───────┴─────┴──────────┴──────────╯</span>
<span class="sd">            ╭─────────────────────────────┬───────────┬─────────┬───────┬──────────┬───────────┬───────────────┬──────────╮</span>
<span class="sd">            │                      WORKER │   VERSION │   CHIPS │   LOC │   ENERGY │   RUNTIME │   LAST UPDATE │   STATUS │</span>
<span class="sd">            ├─────────────────────────────┼───────────┼─────────┼───────┼──────────┼───────────┼───────────────┼──────────┤</span>
<span class="sd">            │ *** WAITING FOR WORKERS *** │           │         │       │          │           │               │          │</span>
<span class="sd">            ╰─────────────────────────────┴───────────┴─────────┴───────┴──────────┴───────────┴───────────────┴──────────╯</span>
<span class="sd">            [DYNEX] FINISHED READ AFTER 0.07 SECONDS</span>
<span class="sd">            [DYNEX] PARSING 1 VOLTAGE ASSIGNMENT FILES...</span>
<span class="sd">            progress: 100%</span>
<span class="sd">            1/1 [00:05&lt;00:00, 5.14s/it]</span>
<span class="sd">            [DYNEX] SAMPLESET LOADED</span>
<span class="sd">            [DYNEX] MALLOB: JOB UPDATED: 3617 STATUS: 2</span>
<span class="sd">               0  1 energy num_oc.</span>
<span class="sd">            0  0  1   -1.0       1</span>
<span class="sd">            [&#39;BINARY&#39;, 1 rows, 1 samples, 2 variables]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">mainnet</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mainnet</span><span class="p">;</span>

        <span class="k">try</span><span class="p">:</span>
        
            <span class="c1"># step 1: upload problem file to Dynex Platform: ---------------------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="c1"># create job on mallob system:</span>
                <span class="n">JOB_ID</span> <span class="o">=</span> <span class="n">generate_job_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">annealing_time</span><span class="p">,</span> <span class="n">switchfraction</span><span class="p">,</span> <span class="n">num_reads</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">zeta</span><span class="p">,</span> <span class="n">minimum_stepsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
                <span class="c1"># upload job:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ÐYNEX] SUBMITTING JOB - UPLOADING JOB FILE...&quot;</span><span class="p">);</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">upload_file_to_ftp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ftp_hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_password</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;[DYNEX] ERROR: FILE UPLOAD FAILED.&quot;</span><span class="p">);</span>

                <span class="c1"># now set the job as ready to be worked on:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ÐYNEX] SUBMITTING START COMMAND...&quot;</span><span class="p">);</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: CANNOT START JOB&#39;</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[ÐYNEX] STARTING JOB...&quot;</span><span class="p">);</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># run on test-net:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;wcnf&#39;</span><span class="p">:</span>
                    <span class="n">localtype</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;cnf&#39;</span><span class="p">:</span>
                    <span class="n">localtype</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">JOB_ID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
                <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">solverpath</span><span class="o">+</span><span class="s2">&quot;np -t=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">localtype</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; -ms=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">annealing_time</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; -st=1 -msz=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">minimum_stepsize</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; -c=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num_reads</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; --file=&#39;&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath_full</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>

                <span class="k">if</span> <span class="n">alpha</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --alpha=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">alpha</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">beta</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --beta=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">beta</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">gamma</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --gamma=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">gamma</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">delta</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --delta=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">delta</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">epsilon</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --epsilon=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">epsilon</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">zeta</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="s2">&quot; --zeta=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">zeta</span><span class="p">);</span>

                <span class="n">process</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">debugging</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">process</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
                        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                    	<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX|TESTNET] *** WAITING FOR READS ***&quot;</span><span class="p">);</span>
                    <span class="n">process</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>

            <span class="c1"># step 2: wait for process to be finished: -------------------------------------------------------------------------------------</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">();</span>
            <span class="n">finished</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
            <span class="n">runupdated</span> <span class="o">=</span> <span class="kc">False</span><span class="p">;</span>
            <span class="n">cnt_workers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">while</span> <span class="n">finished</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="n">total_chips</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">total_steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="n">lowest_energy</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>
                <span class="n">lowest_loc</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>

                <span class="c1"># retrieve solutions</span>
                <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="n">list_files_with_text</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span>
                        <span class="n">cnt_workers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">);</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] CONNECTION TO FTP ENDPOINT FAILED:&#39;</span><span class="p">,</span><span class="n">e</span><span class="p">);</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;ERROR: ONNECTION TO FTP ENDPOINT FAILED&#39;</span><span class="p">)</span>
                        <span class="n">files</span> <span class="o">=</span> <span class="p">[];</span> 
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">files</span> <span class="o">=</span> <span class="n">list_files_with_text_local</span><span class="p">(</span><span class="bp">self</span><span class="p">);</span> 
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

                <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                    <span class="n">info</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:];</span>
                    <span class="n">chips</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
                    <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
                    <span class="n">loc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]);</span>
                    <span class="c1"># energy can also be non decimal:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                        <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]);</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]);</span>
                    <span class="n">total_chips</span> <span class="o">=</span> <span class="n">total_chips</span> <span class="o">+</span> <span class="n">chips</span><span class="p">;</span>
                    <span class="n">total_steps</span> <span class="o">=</span> <span class="n">steps</span><span class="p">;</span>
                    <span class="k">if</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="n">lowest_energy</span><span class="p">:</span>
                        <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">energy</span><span class="p">;</span>
                    <span class="k">if</span> <span class="n">loc</span> <span class="o">&lt;</span> <span class="n">lowest_loc</span><span class="p">:</span>
                        <span class="n">lowest_loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="o">==</span><span class="s1">&#39;cnf&#39;</span> <span class="ow">and</span> <span class="n">loc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
                    <span class="k">if</span> <span class="n">total_chips</span> <span class="o">&gt;=</span> <span class="n">num_reads</span><span class="o">*</span><span class="mf">0.90</span><span class="p">:</span>
                        <span class="n">finished</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>

                <span class="k">if</span> <span class="n">cnt_workers</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                        	<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
                        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                            <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">get_status_details_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">);</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span>
                            <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="p">;</span>
                        <span class="c1"># display:</span>
                        <span class="n">table</span> <span class="o">=</span> <span class="p">([[</span><span class="s1">&#39;DYNEXJOB&#39;</span><span class="p">,</span><span class="s1">&#39;ELAPSED&#39;</span><span class="p">,</span><span class="s1">&#39;WORKERS&#39;</span><span class="p">,</span><span class="s1">&#39;CHIPS&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;STEPS&#39;</span><span class="p">,</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">]]);</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;*** WAITING FOR READS ***&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">]);</span>
                        <span class="n">ta</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;firstrow&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;rounded_grid&#39;</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">);</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">details</span><span class="p">);</span>
                        
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span> 

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                        	<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
                        <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                            <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">get_status_details_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">);</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span>
                            <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                        <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="p">;</span>
                        <span class="c1"># display:</span>
                        <span class="n">table</span> <span class="o">=</span> <span class="p">([[</span><span class="s1">&#39;DYNEXJOB&#39;</span><span class="p">,</span><span class="s1">&#39;ELAPSED&#39;</span><span class="p">,</span><span class="s1">&#39;WORKERS&#39;</span><span class="p">,</span><span class="s1">&#39;CHIPS&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;STEPS&#39;</span><span class="p">,</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">]]);</span>
                        <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="p">,</span> <span class="n">cnt_workers</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span><span class="p">,</span> <span class="n">total_chips</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">,</span> <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">lowest_loc</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="p">]);</span>
                        <span class="n">ta</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;firstrow&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;rounded_grid&#39;</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">);</span>
                        <span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">details</span><span class="p">);</span>

                        <span class="c1"># update mallob - job running: -------------------------------------------------------------------------------------------------</span>
                        <span class="k">if</span> <span class="n">runupdated</span><span class="o">==</span><span class="kc">False</span> <span class="ow">and</span> <span class="n">mainnet</span><span class="p">:</span>
                            <span class="n">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
                            <span class="n">runupdated</span> <span class="o">=</span> <span class="kc">True</span><span class="p">;</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

            <span class="c1"># update mallob - job finished: -------------------------------------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="n">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">,</span> <span class="n">workers</span><span class="o">=</span><span class="n">cnt_workers</span><span class="p">,</span> <span class="n">lowest_loc</span><span class="o">=</span><span class="n">lowest_loc</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="o">=</span><span class="n">lowest_energy</span><span class="p">);</span>

            <span class="c1"># update final output (display all workers as stopped as well):</span>
            <span class="k">if</span> <span class="n">cnt_workers</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                	<span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
                <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                    <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span><span class="p">,</span> <span class="n">details</span> <span class="o">=</span> <span class="n">get_status_details_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="n">all_stopped</span> <span class="o">=</span> <span class="kc">True</span><span class="p">);</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">;</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
                <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="p">;</span>
                <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                    <span class="c1"># display:</span>
                    <span class="n">table</span> <span class="o">=</span> <span class="p">([[</span><span class="s1">&#39;DYNEXJOB&#39;</span><span class="p">,</span><span class="s1">&#39;ELAPSED&#39;</span><span class="p">,</span><span class="s1">&#39;WORKERS&#39;</span><span class="p">,</span><span class="s1">&#39;CHIPS&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;STEPS&#39;</span><span class="p">,</span><span class="s1">&#39;LOC&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">,</span><span class="s1">&#39;ENERGY&#39;</span><span class="p">,</span><span class="s1">&#39;✔&#39;</span><span class="p">]]);</span>
                    <span class="n">table</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="n">elapsed_time</span><span class="p">,</span> <span class="n">cnt_workers</span><span class="p">,</span> <span class="n">MALLOB_CHIPS</span><span class="p">,</span> <span class="n">total_chips</span><span class="p">,</span> <span class="n">total_steps</span><span class="p">,</span> <span class="n">LOC_MIN</span><span class="p">,</span> <span class="n">lowest_loc</span><span class="p">,</span> <span class="n">ENERGY_MIN</span><span class="p">,</span> <span class="n">lowest_energy</span><span class="p">]);</span>
                    <span class="n">ta</span> <span class="o">=</span> <span class="n">tabulate</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;firstrow&quot;</span><span class="p">,</span> <span class="n">tablefmt</span><span class="o">=</span><span class="s1">&#39;rounded_grid&#39;</span><span class="p">,</span> <span class="n">floatfmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">);</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="n">details</span><span class="p">);</span>
                
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] FINISHED READ AFTER&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">elapsed_time</span><span class="p">,</span><span class="s2">&quot;SECONDS&quot;</span><span class="p">);</span>

            
            <span class="c1"># step 3: now parse voltages: ---------------------------------------------------------------------------------------------------</span>
            
            <span class="n">sampleset</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="n">lowest_energy</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>
            <span class="n">lowest_loc</span> <span class="o">=</span> <span class="mf">1.7976931348623158e+308</span><span class="p">;</span>
            <span class="n">total_chips</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">total_steps</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="n">lowest_set</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="n">dimod_sample</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
                <span class="c1"># format: xxx.bin.32.1.0.0.000000</span>
                <span class="c1"># jobfile chips steps loc energy</span>
                <span class="n">info</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:];</span>
                <span class="n">chips</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
                <span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
                <span class="n">loc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]);</span>

                <span class="c1"># energy can also be non decimal:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">:</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;.&quot;</span><span class="o">+</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]);</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">energy</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">info</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]);</span>
                <span class="n">total_chips</span> <span class="o">=</span> <span class="n">total_chips</span> <span class="o">+</span> <span class="n">chips</span><span class="p">;</span>
                <span class="n">total_steps</span> <span class="o">=</span> <span class="n">steps</span><span class="p">;</span>

                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ffile</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">ffile</span><span class="o">.</span><span class="n">read</span><span class="p">();</span>
                    <span class="c1"># enough data?</span>
                    <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                    	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">96</span><span class="p">:</span>
                    		<span class="n">wallet</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
                    		<span class="n">tmp</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
                    		<span class="n">voltages</span> <span class="o">=</span> <span class="n">tmp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
                    	<span class="k">else</span><span class="p">:</span>
                    		<span class="n">voltages</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;NaN&#39;</span><span class="p">];</span> <span class="c1"># invalid file received</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c1"># test-net is not returning wallet</span>
                    	<span class="n">voltages</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>

                <span class="c1"># valid result? ignore Nan values and other incorrect data</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">voltages</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">voltages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;NaN&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">voltages</span><span class="p">):</span>
                    <span class="n">sampleset</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span><span class="n">voltages</span><span class="p">,</span><span class="s1">&#39;chips&#39;</span><span class="p">,</span><span class="n">chips</span><span class="p">,</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="n">steps</span><span class="p">,</span><span class="s1">&#39;falsified softs&#39;</span><span class="p">,</span><span class="n">loc</span><span class="p">,</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="n">energy</span><span class="p">]);</span>
                    <span class="k">if</span> <span class="n">loc</span> <span class="o">&lt;</span> <span class="n">lowest_loc</span><span class="p">:</span>
                        <span class="n">lowest_loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">;</span>
                    <span class="k">if</span> <span class="n">energy</span> <span class="o">&lt;</span> <span class="n">lowest_energy</span><span class="p">:</span>
                        <span class="n">lowest_energy</span> <span class="o">=</span> <span class="n">energy</span><span class="p">;</span>
                        <span class="n">lowest_set</span> <span class="o">=</span> <span class="n">voltages</span><span class="p">;</span>
                    <span class="c1"># add voltages to dimod return sampleset:</span>
                    <span class="n">dimodsample</span> <span class="o">=</span> <span class="p">{};</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">):</span> 
                        <span class="c1"># mapped variable?</span>
                        <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">:</span>
                            <span class="n">dimodsample</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> 
                            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">voltages</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
                                <span class="n">dimodsample</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">dimodsample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  
                            <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">voltages</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
                                <span class="n">dimodsample</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  
                        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            
                    <span class="n">dimod_sample</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dimodsample</span><span class="p">);</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[DYNEX] OMITTED SOLUTION FILE:&#39;</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="s1">&#39; - INCORRECT DATA&#39;</span><span class="p">);</span>

            <span class="n">sampleset</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;sample&#39;</span><span class="p">,</span><span class="n">lowest_set</span><span class="p">,</span><span class="s1">&#39;chips&#39;</span><span class="p">,</span><span class="n">total_chips</span><span class="p">,</span><span class="s1">&#39;steps&#39;</span><span class="p">,</span><span class="n">total_steps</span><span class="p">,</span><span class="s1">&#39;falsified softs&#39;</span><span class="p">,</span><span class="n">lowest_loc</span><span class="p">,</span><span class="s1">&#39;energy&#39;</span><span class="p">,</span><span class="n">lowest_energy</span><span class="p">]);</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">process_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t</span><span class="p">;</span>

            <span class="c1"># delete computing file: ---------------------------------------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
            	<span class="n">delete_file_on_ftp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ftp_hostname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_username</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_password</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftp_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
            
            <span class="c1"># build sample dict &quot;assignments&quot; with 0/1 and dimod_sampleset ------------------------------------------------------------------</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;wcnf&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">lowest_set</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_variables</span><span class="p">:</span>
                <span class="n">sample</span> <span class="o">=</span> <span class="p">{};</span>
                <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_mappings</span><span class="p">:</span>
                    <span class="n">sample</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lowest_set</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">):</span>
                        <span class="n">sample</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assignments</span> <span class="o">=</span> <span class="n">sample</span><span class="p">;</span>

                <span class="c1"># generate dimod format sampleset: </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dimod_assignments</span> <span class="o">=</span> <span class="n">dimod</span><span class="o">.</span><span class="n">SampleSet</span><span class="o">.</span><span class="n">from_samples_bqm</span><span class="p">(</span><span class="n">dimod_sample</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bqm</span><span class="p">);</span>
                

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] SAMPLESET LOADED&quot;</span><span class="p">);</span>
            
            <span class="c1"># create return sampleset: ------------------------------------------------------------------------------------------------------</span>
            <span class="n">sampleset_clean</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">sampleset</span><span class="p">:</span>
                <span class="n">sample_dict</span> <span class="o">=</span> <span class="n">Convert</span><span class="p">(</span><span class="n">sample</span><span class="p">);</span>
                <span class="n">sampleset_clean</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sample_dict</span><span class="p">);</span>

        <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="n">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] Keyboard interrupt&quot;</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">{};</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mainnet</span><span class="p">:</span>
                <span class="n">update_job_api</span><span class="p">(</span><span class="n">JOB_ID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">logging</span><span class="p">);</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[DYNEX] Exception encountered:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
            <span class="k">return</span> <span class="p">{};</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sampleset</span> <span class="o">=</span> <span class="n">sampleset_clean</span><span class="p">;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimod_assignments</span><span class="p">;</span> </div></div>
        
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Dynex Developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>